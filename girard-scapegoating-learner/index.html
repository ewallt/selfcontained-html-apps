<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Learner: Girard's Scapegoat Theory (Full)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* General body and container styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light gray-blue background */
            color: #1a202c; /* Dark gray text */
            margin: 0;
            padding: 0;
        }
        /* Main container for responsiveness */
        .container {
            max-width: 800px; /* Max width for larger screens */
            margin: 2rem auto; /* Center the container */
            padding: 1rem; /* Padding for smaller screens */
        }

        /* --- Knowledge Display Styles --- */
        /* Container for the entire knowledge base display area */
        #knowledge-display-area {
             background-color: #f9fafb; /* Slightly off-white background */
             border-radius: 8px;
             padding: 1rem;
             box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }

        /* Style for each Level 1 Concept block */
        .level1-concept-container {
            background-color: #ffffff; /* White background for L1 blocks */
            border: 1px solid #e5e7eb; /* Gray 200 border */
            border-radius: 8px; /* Rounded corners */
            margin-bottom: 1.5rem; /* Space between L1 blocks */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* Subtle shadow */
            overflow: hidden; /* Ensure children corners are clipped */
        }

        /* Clickable header for Level 1 Concept */
        .level1-concept-header {
            padding: 1rem 1.25rem; /* More padding for L1 header */
            background-color: #eef2ff; /* Indigo 100 background */
            border-bottom: 1px solid #e5e7eb;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            list-style: none; /* Remove default marker */
        }
         .level1-concept-header::-webkit-details-marker { display: none; } /* Hide marker in Webkit */
         .level1-concept-header:hover {
            background-color: #e0e7ff; /* Indigo 200 on hover */
         }

        /* Level 1 Concept Title */
        .level1-concept-header h3 {
            color: #4338ca; /* Indigo 700 */
            font-weight: 700; /* Bold */
            font-size: 1.25rem; /* Larger font */
            margin: 0;
        }

        /* Container for all Level 2 sub-topics within a Level 1 block */
        .level2-topics-wrapper {
             padding: 0.5rem 1rem 1rem 1rem; /* Padding around L2 topics */
             background-color: #ffffff; /* White background */
        }

        /* Container for each L2 sub-topic (using <details>) */
        .sub-topic-container {
            background-color: #f9fafb; /* Gray 50 background for L2 */
            border: 1px solid #e5e7eb; /* Light gray border */
            border-radius: 6px; /* Slightly less rounded corners */
            margin-bottom: 0.75rem; /* Space between L2 topics */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* Very subtle shadow */
            overflow: hidden;
        }

        /* Clickable header for L2 sub-topic (using <summary>) */
        .sub-topic-header {
            padding: 0.75rem 1rem;
            background-color: #f9fafb; /* Gray 50 */
            border-bottom: 1px solid #e5e7eb;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            list-style: none; /* Remove default marker */
        }
        .sub-topic-header::-webkit-details-marker { display: none; } /* Hide marker in Webkit */
        .sub-topic-header:hover {
            background-color: #f3f4f6; /* Gray 100 on hover */
        }

        /* Level 2 Sub-Topic Title */
        .sub-topic-header h4 {
            color: #4f46e5; /* Indigo 600 */
            font-weight: 600; /* Semibold */
            font-size: 1rem;
            margin: 0;
        }

        /* List of insights under an L2 sub-topic */
        .insights-list {
            padding: 0.75rem 1rem 1rem 2rem; /* Indent insights */
            list-style-type: disc; /* Use bullet points */
            background-color: #f9fafb; /* Match L2 background */
            margin: 0;
        }
        .insights-list li { /* Individual insight item */
            margin-bottom: 0.5rem;
            color: #4b5563; /* Gray 600 text */
            font-size: 0.9rem; /* Slightly smaller insight text */
            line-height: 1.6; /* Improve readability */
        }

        /* Toggler icon (shared by L1 and L2) */
        .toggler-icon {
            transition: transform 0.2s ease-in-out;
            font-size: 1.2rem;
            color: #6366f1; /* Indigo 500 */
        }
        /* Rotate icon when <details> section is open */
        details[open] > summary .toggler-icon {
            transform: rotate(90deg);
        }

        /* --- Trivia/Quiz App Styles (mostly unchanged) --- */
        .trivia-container {
            background-color: #ffffff;
            padding: 24px; /* Default padding */
            border-radius: 12px; /* More pronounced rounded corners */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); /* Soft shadow */
            width: 100%; /* Ensure it takes full width of its parent */
            margin-top: 2rem; /* Add space above quiz */
        }
        /* Larger padding on medium screens and up */
        @media (min-width: 640px) {
            .trivia-container { padding: 32px; }
        }
        .answer-btn { /* Styling for answer buttons */
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out, box-shadow 0.1s ease-in-out; /* Smooth transitions */
            border: 1px solid #e2e8f0; /* Light gray border */
            min-height: 60px; /* Ensure sufficient touch target height */
            padding: 0.75rem 1rem; /* Comfortable padding */
            display: flex; /* Use flexbox for alignment */
            justify-content: center; /* Center text horizontally */
            align-items: center; /* Center text vertically */
            text-align: center;
            font-weight: 500; /* Medium font weight */
            border-radius: 8px; /* Rounded corners */
            line-height: 1.4; /* Adjust line height for wrapped text */
            word-break: break-word; /* Allow long words to break */
            background-color: #ffffff; /* Default white background */
            color: #1a202c; /* Default text color */
            cursor: pointer;
        }
        .answer-btn:hover:not(:disabled) {
            background-color: #f8fafc; /* Very light gray on hover */
            transform: translateY(-2px); /* Slight lift effect */
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); /* Add subtle shadow on hover */
        }
        .answer-btn.correct { /* Styling for correctly selected answer */
            background-color: #10B981 !important; /* Tailwind Green-500 */
            color: white !important;
            border-color: #059669 !important; /* Tailwind Green-600 */
        }
        .answer-btn.incorrect { /* Styling for incorrectly selected answer */
            background-color: #EF4444 !important; /* Tailwind Red-500 */
            color: white !important;
            border-color: #DC2626 !important; /* Tailwind Red-600 */
        }
        .answer-btn:disabled { /* Styling for disabled answer buttons (after selection) */
            opacity: 0.8; /* Slightly faded */
            cursor: not-allowed;
            transform: none; /* Prevent hover effects */
            box-shadow: none;
        }
        #feedback { /* Styling for feedback message (Correct/Incorrect) */
            min-height: 24px; /* Reserve space to prevent layout shift */
            font-weight: 600; /* Bolder feedback */
            margin-bottom: 1rem;
            font-size: 1.1rem; /* Slightly larger feedback text */
        }
        /* Ensure spans within buttons inherit color correctly for correct/incorrect states */
        .answer-btn.correct span, .answer-btn.incorrect span {
            color: white;
        }
        /* Default text color for span within button (redundant but safe) */
        .answer-btn span {
            color: inherit; /* Inherit color from button */
        }
        #score, #question-counter, #session-counter { /* Styling for score and counter text */
            color: #4a5568; /* Medium gray text */
            font-weight: 500;
        }
        /* Styling for disabled Next and Practice buttons */
        #next-btn:disabled, #practice-btn:disabled {
            background-color: #9ca3af !important; /* Grayed out */
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        /* Prevent hover effect when disabled */
        #next-btn:disabled:hover, #practice-btn:disabled:hover {
            background-color: #9ca3af !important;
        }
        /* Specific styling for the practice button */
        #practice-btn {
            background-color: #f59e0b; /* Amber 500 */
            transition: background-color 0.2s ease;
        }
        #practice-btn:hover:not(:disabled) {
            background-color: #d97706; /* Amber 600 for hover */
        }
        /* General button styling (Next, Restart, Practice) */
        .action-btn {
             transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
             padding: 0.75rem 1.5rem; /* py-3 px-6 equivalent */
             border-radius: 8px; /* rounded-lg */
             font-weight: 600; /* font-semibold */
             color: white;
             box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-md */
             cursor: pointer;
             display: inline-block; /* Allow margin/padding */
        }
        .action-btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 6px 8px -1px rgba(0, 0, 0, 0.1), 0 3px 5px -1px rgba(0, 0, 0, 0.08);
        }

    </style>
</head>
<body>
    <div class="container mx-auto p-4">
        <header class="text-center mb-10">
            <h1 class="text-3xl sm:text-4xl font-bold text-indigo-700">Knowledge Learner: René Girard's Scapegoat Theory</h1>
        </header>

        <section id="knowledge-display-section" class="mb-12">
            <h2 class="text-2xl font-semibold mb-6 text-center text-indigo-600">Learn: Core Concepts & Theory</h2>
            <div id="knowledge-display-area">
                </div>
        </section>

        <section id="quiz-section">
            <div id="quiz-area" class="trivia-container text-center">
                <h2 id="quiz-title" class="text-2xl font-bold mb-4 text-indigo-600">Test Your Knowledge!</h2>
                <div id="score-area" class="mb-4 text-lg flex flex-wrap justify-center items-center gap-x-3 gap-y-1">
                    <span id="score" class="font-semibold">Score: 0</span>
                    <span class="text-gray-400 hidden sm:inline">|</span>
                    <span id="question-counter" class="font-semibold">Question: 0 / 0</span>
                     <span class="text-gray-400 hidden sm:inline">|</span>
                    <span id="session-counter" class="font-semibold">Section: 0 / 0</span> </div>
                <div id="question-area" class="mb-6">
                    <h3 id="question-text" class="text-xl font-semibold mb-4 min-h-[60px] flex items-center justify-center text-gray-700 px-2">
                        Loading question...
                    </h3>
                    <div id="answer-buttons" class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                        </div>
                </div>
                <div id="feedback" class="mt-4 text-lg font-medium min-h-[24px] mb-4">
                    &nbsp; </div>
                <button id="next-btn" class="action-btn mt-2 bg-indigo-600 hover:bg-indigo-700 w-full sm:w-auto">
                    Next Question
                </button>
                <div id="game-over-message" class="hidden mt-6 text-xl font-semibold">
                    <p id="final-score-message" class="mb-4"></p>
                    <div class="flex flex-col sm:flex-row justify-center items-center gap-3">
                        <button id="restart-btn" class="action-btn bg-green-500 hover:bg-green-600 w-full sm:w-auto">
                            </button>
                        <button id="practice-btn" class="action-btn hidden bg-yellow-500 hover:bg-yellow-600 w-full sm:w-auto">
                            Practice Weak Areas
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // --- 1. KNOWLEDGE BASE DATA ---
        // Array containing all Level 1 concepts and their nested Level 2 sub-topics/insights.
        const knowledgeBaseData = [
          {
            level1Concept: "Mimetic Desire",
            level2SubTopics: [
              { name: "Triangular Structure of Desire", insights: [ "Desire is mediated; a model’s wanting confers value on an object, creating a triangle of subject‑model‑object.", "The subject imitates the model’s desire, not merely noticing but internalising the model’s valuation.", "This structure is ubiquitous in classic novels, revealing imitation as a hidden driver of plot and character motivation." ] },
              { name: "Internal vs External Mediation", insights: [ "External models are distant idols whose desires inspire without rivalry, fostering aspiration rather than conflict.", "Internal mediation occurs among peers; proximity makes the desired object scarce and rivalry almost certain.", "Transition from external to internal mediation often marks the tipping point from admiration to resentment." ] },
              { name: "Metaphysical Desire", insights: [ "Beyond objects, imitators crave the model’s very being, seeking ontological fullness through possession.", "This deeper hunger intensifies competition, because the model’s identity cannot be shared or replicated.", "Metaphysical desire explains chronic dissatisfaction after acquisition; the real aim was the model’s stature, not the thing." ] },
              { name: "Positive vs Negative Mimesis", insights: [ "Imitation can transmit virtues—charity, courage—when the model embodies self‑giving rather than acquisitive will.", "Negative mimesis centres on scarce goods and prestige, breeding envy and escalating rivalry.", "The same imitative faculty underlies both outcomes; ethical direction depends on the model imitated." ] },
              { name: "Neurobiological Correlates", insights: [ "Mirror‑neuron research confirms humans are wired to reproduce observed intentions and emotions.", "This neural substrate makes mimetic contagion rapid and largely subconscious, aligning biology with Girard’s anthropology.", "Recognition of this circuitry offers empirical grounding for cultural patterns previously inferred from texts and rituals." ] }
            ]
          },
          {
            level1Concept: "Mimetic Rivalry and Sacrificial Crisis",
            level2SubTopics: [
              { name: "Contagion and Monstrous Doubles", insights: [ "Rivals imitate each other’s hostility until their identities converge, becoming indistinguishable antagonists.", "This mirroring spreads by imitation, drawing neutral parties into the feud and multiplying conflicts.", "Literature and history illustrate these feedback loops, from feuding clans to gang reprisals." ] },
              { name: "Escalation to All‑Against‑All", insights: [ "As rivalries proliferate, social hierarchies collapse, producing undifferentiated violence.", "Myths symbolise this phase with plagues or cosmic disorder, encoding real communal breakdowns.", "The crisis generates intolerable uncertainty, compelling the group to seek a unifying outlet." ] },
              { name: "Role of Envy and Scandal", insights: [ "Envy intensifies when the model obstructs the imitator, turning admiration into hatred.", "The scandalised imitator both rejects and fixates on the rival, deepening obsession.", "Such ambivalence accelerates conflict, as each side blames the other for the same provocative desire." ] },
              { name: "Founding Murder Concept", insights: [ "A spontaneous lynching of a single victim redirects diffuse aggression into unanimous violence.", "Sudden peace confirms, in persecutors’ minds, the victim’s guilt and salvific power.", "This primal event becomes the template for future order, ritual, and sovereignty." ] },
              { name: "Unconscious Nature of Resolution", insights: [ "The community must believe the scapegoat guilty; recognising innocence would nullify catharsis.", "Mythic retellings mask group violence, preserving ignorance across generations.", "Modern persecutions, from witch hunts to pogroms, display this same blindness among perpetrators." ] }
            ]
          },
          {
            level1Concept: "The Scapegoat Mechanism",
            level2SubTopics: [
              { name: "Victim Signs and Marginality", insights: [ "Scapegoats often bear ambivalent markers—outsider yet familiar, weak yet symbolically potent.", "Physical deformity, foreign origin, or liminal social roles facilitate broad consensus on blame.", "Such markers enable projection of communal ills without threatening core insiders." ] },
              { name: "Stereotyped Accusations", insights: [ "Charges of incest, poisoning, or sacrilege recur across cultures as catch‑all explanations for crisis.", "The alleged crimes are both heinous and contagious, rationalising total elimination of the accused.", "Textual analysis of medieval plague chronicles and witch‑hunt records confirms these accusation patterns." ] },
              { name: "Cathartic Unanimity", insights: [ "Collective violence forges sudden solidarity among former rivals, ending mimetic chaos.", "Emotional relief reinforces the belief that the victim was causal agent of prior disorder.", "This unanimity is self‑validating and thus difficult to challenge from within the group." ] },
              { name: "Birth of the Sacred", insights: [ "The slain scapegoat acquires dual status—demonic source of crisis and divine bringer of peace.", "Ambivalence toward the victim crystallises into sacred myth, ritual, and taboo.", "Deification memorialises the violence while concealing its human origin." ] },
              { name: "Ritual Substitution", insights: [ "Subsequent sacrifices replay the founding murder with animals or symbolic surrogates.", "Controlled repetition channels aggression predictably, preventing uncontrolled crises.", "The shift from human to animal victims reflects gradual moral discomfort yet preserves the mechanism." ] }
            ]
          },
          {
            level1Concept: "Myth, Ritual, and Cultural Institutions",
            level2SubTopics: [
              { name: "Myth as Persecutor Narrative", insights: [ "Myths recount the crisis and its violent resolution from the victor’s viewpoint, confirming victim guilt.", "Fantastic motifs distract from the mundane fact of mob murder.", "Comparative reading reveals structural uniformity beneath diverse story worlds." ] },
              { name: "Ritual Sacrifice for Social Order", insights: [ "Periodic rites restage the scapegoat killing to renew communal cohesion.", "Examples range from Greek pharmakos expulsions to the Hebrew Day of Atonement goat.", "Ritual violence is thereby domesticated, presented as divine command rather than human expedient." ] },
              { name: "Taboos and Moral Codes", insights: [ "Prohibitions memorialise the scapegoat’s supposed sin, marking behaviours blamed for past chaos.", "Universal incest and murder taboos mirror common stereotypes of accusation.", "Law thus arises as negative recollection of communal violence, not pure rational contract." ] },
              { name: "Kingship and Legal Institutions", insights: [ "Early rulers often occupy a former victim’s place, wielding sacred authority derived from prior sacrifice.", "Legal courts channel vengeance into codified procedures, reducing random scapegoats.", "Nonetheless, punishment retains vestiges of “one suffers for all,” echoing sacrificial logic." ] },
              { name: "Animal Domestication as Substitute", insights: [ "Girard links the rise of pastoral sacrifice to displacement of earlier human victims.", "Regular animal offerings provide harmless outlets for violence, stabilising agrarian societies.", "Scriptural prescriptions for spotless beasts reflect the quest for perfect, non‑retaliatory substitutes." ] }
            ]
          },
          {
            level1Concept: "Biblical Revelation and Christian Distinctiveness",
            level2SubTopics: [
              { name: "Victim Perspective in Hebrew Scripture", insights: [ "Stories of Abel, Joseph, and Job foreground innocent sufferers, challenging majority verdicts.", "Prophets condemn rituals that mask oppression, siding explicitly with the marginalised.", "These texts train readers to doubt unanimous violence and hear the silenced voice." ] },
              { name: "The Cross as Final Scapegoat Exposure", insights: [ "Jesus is executed by collective consensus, perfectly enacting scapegoat logic.", "Gospel emphasis on his innocence reveals the mechanism rather than concealing it.", "Resurrection without revenge offers a non‑violent alternative to sacrificial order." ] },
              { name: "Satan as Personification of Accusation", insights: [ "Girard interprets Satan not as metaphysical rival of God but as the cycle of accusation itself.", "“I saw Satan fall” signals the exposure and delegitimisation of scapegoat power.", "Christian mission thus centres on breaking accusation, not appeasing divine wrath." ] },
              { name: "Western Culture’s Concern for Victims", insights: [ "Biblical influence spreads suspicion toward mob violence, fostering human‑rights discourse.", "Modern literature and law increasingly champion the wrongly accused, reflecting Gospel impact.", "This concern destabilises traditional sacrificial systems, forcing societies to invent new peace‑keeping tools." ] },
              { name: "Progressive Revelation Within Scripture", insights: [ "Early texts retain sacrificial elements; later writings critique and transcend them.", "Psalmists and prophets voice victims’ laments, undermining mythic justification.", "The canon thus records an internal struggle moving from sacred violence toward unveiled innocence." ] }
            ]
          },
          {
            level1Concept: "Contemporary Relevance and Critical Debates",
            level2SubTopics: [
              { name: "Social‑Media Scapegoating", insights: [ "Online outrage rapidly converges on individuals, reproducing all‑against‑one dynamics at scale.", "Algorithms magnify mimetic signals (likes, shares), accelerating contagion.", "Digital anonymity lowers thresholds for participation, intensifying virtual mob power." ] },
              { name: "Political Populism", insights: [ "Leaders galvanise followers by blaming elites or minorities, offering scapegoats for economic anxiety.", "Short‑term unity masks policy failures, repeating ancient cathartic logic.", "Girardian analysis warns that such unity is brittle and prone to escalating violence." ] },
              { name: "Applications in Psychology and Therapy", insights: [ "Clinicians adapt mimetic theory to treat envy‑driven neuroses by exposing hidden rival models.", "Family systems therapy identifies scapegoated members whose roles absorb collective tension.", "Awareness of mimetic triggers enables healthier role redistribution and conflict de‑escalation." ] },
              { name: "Scholarly Critiques and Limitations", insights: [ "Critics question the unfalsifiable pre‑historic murder hypothesis and over‑generalisation.", "Comparative mythologists argue not all narratives veil persecution; some celebrate fertility or cosmology without scapegoats.", "Feminist and post‑colonial scholars highlight Girard’s focus on male violence and Western sources, urging broader data sets." ] },
              { name: "Breaking the Cycle – Practical Pathways", insights: [ "Restorative justice seeks dialogue over expulsion, aiming to satisfy communal need for closure without victim creation.", "Education in empathy and critical media literacy can inoculate against mimetic frenzy.", "Some propose platform design changes—slower sharing, contextual prompts—to reduce digital scapegoating velocity." ] }
            ]
          }
        ];


        // --- 2. QUIZ QUESTIONS DATA (Expanded) ---
        // Comprehensive array of quiz questions covering all concepts.
        const allQuizQuestions = [
            // Mimetic Desire (MD)
            { question: "What forms the 'triangle' in Girard's Triangular Structure of Desire?", answers: ["Subject, Model, Object#", "Subject, Object, Goal", "Model, Rival, Prize", "Subject, Mediator, Outcome"], relatedConcept: "Triangular Structure of Desire" },
            { question: "According to Girard, how does an object acquire value in mimetic desire?", answers: ["Through the model's desire for it#", "Through its intrinsic utility", "Through advertising and marketing", "Through scarcity alone"], relatedConcept: "Triangular Structure of Desire" },
            { question: "Where does Girard find evidence for the Triangular Structure of Desire?", answers: ["Classic novels showing hidden imitation#", "Controlled psychological experiments", "Economic market analysis", "Primate behavioral studies"], relatedConcept: "Triangular Structure of Desire" },
            { question: "What characterizes 'External Mediation'?", answers: ["Distant models inspiring aspiration without rivalry#", "Close peers competing for the same object", "A focus on the model's being, not the object", "Imitating negative behaviors like envy"], relatedConcept: "Internal vs External Mediation" },
            { question: "What is the primary consequence of 'Internal Mediation'?", answers: ["Increased likelihood of rivalry and conflict#", "Strengthened social bonds", "Focus shifts to abstract ideals", "Desire diminishes due to proximity"], relatedConcept: "Internal vs External Mediation" },
            { question: "The shift from admiration to resentment often marks the transition between which two forms of mediation?", answers: ["External to Internal#", "Internal to Metaphysical", "Positive to Negative", "Metaphysical to External"], relatedConcept: "Internal vs External Mediation" },
            { question: "What is the object of 'Metaphysical Desire'?", answers: ["The model's perceived being or ontological fullness#", "A specific, tangible object", "Social status and recognition", "Avoiding conflict at all costs"], relatedConcept: "Metaphysical Desire" },
            { question: "Why does Metaphysical Desire intensify competition?", answers: ["The model's identity cannot be shared or replicated#", "The desired object becomes physically scarce", "External mediators intervene", "Neurobiological responses are heightened"], relatedConcept: "Metaphysical Desire" },
            { question: "What explains the chronic dissatisfaction often felt after obtaining an object desired metaphysically?", answers: ["The real aim was the model's stature, not the object#", "The object loses its intrinsic value", "Society disapproves of the acquisition", "The subject realizes the desire was irrational"], relatedConcept: "Metaphysical Desire" },
            { question: "'Positive Mimesis' involves imitating models who embody...", answers: ["Self-giving virtues like charity or courage#", "Acquisitive will and desire for prestige", "Aggression and hostility", "Ambivalent social markers"], relatedConcept: "Positive vs Negative Mimesis" },
            { question: "What does 'Negative Mimesis' typically center on?", answers: ["Scarce goods and prestige, breeding envy#", "Shared community values", "Acts of altruism", "Distant, unattainable ideals"], relatedConcept: "Positive vs Negative Mimesis" },
            { question: "According to Girard, what determines whether imitation leads to positive or negative outcomes?", answers: ["The ethical direction of the model imitated#", "The inherent nature of the subject", "The value of the object desired", "The distance between subject and model"], relatedConcept: "Positive vs Negative Mimesis" },
            { question: "What specific neurological finding supports Girard's ideas about mimetic contagion?", answers: ["Mirror neuron research#", "Studies on the prefrontal cortex", "Analysis of dopamine pathways", "EEG patterns during social interaction"], relatedConcept: "Neurobiological Correlates" },
            { question: "How does the neural substrate (like mirror neurons) relate to mimetic contagion?", answers: ["It makes contagion rapid and largely subconscious#", "It slows down the imitation process", "It requires conscious effort to imitate", "It only applies to positive mimesis"], relatedConcept: "Neurobiological Correlates" },
            { question: "What kind of grounding does neurobiology offer to Girard's theories?", answers: ["Empirical grounding for previously inferred cultural patterns#", "Proof of the founding murder", "Evidence against metaphysical desire", "A basis for rejecting literary analysis"], relatedConcept: "Neurobiological Correlates" },

            // Mimetic Rivalry and Sacrificial Crisis (MRSC)
            { question: "What happens to the identities of rivals during 'Contagion and Monstrous Doubles'?", answers: ["They converge and become indistinguishable#", "They become more distinct and polarized", "One rival adopts the other's identity completely", "Their identities fragment and dissolve"], relatedConcept: "Contagion and Monstrous Doubles" },
            { question: "How does mimetic rivalry spread through a community?", answers: ["Through imitation of hostility, drawing in neutral parties#", "Through rational debate and discussion", "Through external mediators imposing conflict", "Through random acts of violence"], relatedConcept: "Contagion and Monstrous Doubles" },
            { question: "Where can examples of mimetic contagion and doubling be found?", answers: ["Literature (feuding families) and history (gang reprisals)#", "Only in controlled laboratory settings", "Primarily in economic competition", "Exclusively in ancient mythology"], relatedConcept: "Contagion and Monstrous Doubles" },
            { question: "What characterizes the 'Escalation to All-Against-All' phase?", answers: ["Collapse of social hierarchies and undifferentiated violence#", "Strengthening of central authority", "Emergence of clear leaders", "A shift towards peaceful negotiation"], relatedConcept: "Escalation to All‑Against‑All" },
            { question: "How do myths often symbolize the 'All-Against-All' crisis?", answers: ["With plagues, floods, or cosmic disorder#", "With heroic quests and triumphs", "With tales of creation and fertility", "With stories of divine intervention"], relatedConcept: "Escalation to All‑Against‑All" },
            { question: "What psychological state does the 'All-Against-All' crisis generate in a community?", answers: ["Intolerable uncertainty and fear#", "A sense of shared purpose", "Increased rationality", "Widespread apathy"], relatedConcept: "Escalation to All‑Against‑All" },
            { question: "According to Girard, when does envy typically intensify in mimetic rivalry?", answers: ["When the model obstructs the imitator's desire#", "When the model is very distant", "When the object has little value", "When multiple imitators desire different objects"], relatedConcept: "Role of Envy and Scandal" },
            { question: "What defines the 'scandalized' imitator's relationship with the rival?", answers: ["Ambivalent fixation: both rejecting and obsessing over the rival#", "Complete indifference", "Pure admiration", "Objective assessment of the rival's flaws"], relatedConcept: "Role of Envy and Scandal" },
            { question: "How does the ambivalence of envy and scandal affect conflict?", answers: ["It accelerates conflict as each side blames the other#", "It leads to de-escalation", "It isolates the rivals from the community", "It makes the conflict purely symbolic"], relatedConcept: "Role of Envy and Scandal" },
            { question: "What is the 'Founding Murder' in Girard's theory?", answers: ["A spontaneous lynching that redirects diffuse aggression onto one victim#", "A planned assassination of a leader", "A ritual sacrifice performed by priests", "A death resulting from natural disaster"], relatedConcept: "Founding Murder Concept" },
            { question: "How does the community interpret the peace that follows the Founding Murder?", answers: ["As confirmation of the victim's guilt and power#", "As a random coincidence", "As a sign of their own collective strength", "As proof of divine intervention unrelated to the victim"], relatedConcept: "Founding Murder Concept" },
            { question: "What does the Founding Murder become a template for?", answers: ["Future social order, ritual, and sovereignty#", "Increased chaos and violence", "Complete social dissolution", "A society based on pure reason"], relatedConcept: "Founding Murder Concept" },
            { question: "Why must the community remain unconscious of the scapegoat's innocence?", answers: ["Recognizing innocence would nullify the cathartic effect#", "Innocence is irrelevant to the mechanism", "Guilt is necessary for legal proceedings", "The victim must genuinely be guilty"], relatedConcept: "Unconscious Nature of Resolution" },
            { question: "How do mythic retellings typically handle the violence of the founding murder?", answers: ["They mask or disguise the collective violence#", "They accurately document the event", "They condemn the perpetrators", "They ignore the violence completely"], relatedConcept: "Unconscious Nature of Resolution" },
            { question: "Where does Girard see the same 'blindness' about victim innocence displayed?", answers: ["Modern persecutions like witch hunts and pogroms#", "Contemporary legal systems", "Scientific research", "Philosophical debates"], relatedConcept: "Unconscious Nature of Resolution" },

            // The Scapegoat Mechanism (SM)
            { question: "Which characteristics often mark a scapegoat, according to Girard?", answers: ["Ambivalent markers: outsider yet familiar, weak yet potent#", "High social status and power", "Complete anonymity", "Perfect conformity to social norms"], relatedConcept: "Victim Signs and Marginality" },
            { question: "Why do markers like physical deformity or foreign origin facilitate scapegoating?", answers: ["They allow projection of ills without threatening core insiders#", "They prove inherent guilt", "They indicate supernatural power", "They are universally disliked traits"], relatedConcept: "Victim Signs and Marginality" },
            { question: "What is the function of selecting victims with marginal or liminal social roles?", answers: ["Enables broad consensus on blame#", "Ensures the victim cannot retaliate", "Satisfies a need for novelty", "Demonstrates the power of the majority"], relatedConcept: "Victim Signs and Marginality" },
            { question: "What kind of accusations are typically leveled against scapegoats?", answers: ["Stereotyped charges like incest, poisoning, or sacrilege#", "Specific, verifiable crimes", "Minor social infractions", "Political dissent"], relatedConcept: "Stereotyped Accusations" },
            { question: "Why are these stereotyped crimes effective in justifying elimination?", answers: ["They are seen as heinous and contagious#", "They are easy to prove", "They reflect the victim's known behavior", "They are universally understood legal categories"], relatedConcept: "Stereotyped Accusations" },
            { question: "Where can confirmation of these recurring accusation patterns be found?", answers: ["Analysis of historical persecution texts (plague chronicles, witch hunts)#", "Modern psychological profiles", "Ancient legal codes only", "Literary fiction primarily"], relatedConcept: "Stereotyped Accusations" },
            { question: "What is the immediate social effect of the collective violence against the scapegoat?", answers: ["Sudden solidarity and restored unity among former rivals#", "Increased social division", "Widespread guilt and remorse", "Apathy and indifference"], relatedConcept: "Cathartic Unanimity" },
            { question: "How does the emotional relief following the scapegoating reinforce the mechanism?", answers: ["It strengthens the belief that the victim caused the prior disorder#", "It leads to questioning the victim's guilt", "It encourages further violence", "It has no impact on belief"], relatedConcept: "Cathartic Unanimity" },
            { question: "Why is the unanimity achieved through scapegoating difficult to challenge?", answers: ["It is self-validating within the group#", "External observers always agree", "Evidence of innocence is destroyed", "Challengers are immediately scapegoated"], relatedConcept: "Cathartic Unanimity" },
            { question: "What dual status does the slain scapegoat often acquire?", answers: ["Demonic source of crisis AND divine bringer of peace#", "Purely evil and condemned", "Purely good and martyred", "Forgotten and irrelevant"], relatedConcept: "Birth of the Sacred" },
            { question: "The ambivalence towards the victim crystallizes into what cultural forms?", answers: ["Sacred myth, ritual, and taboo#", "Secular laws and contracts", "Historical records", "Artistic expressions of grief"], relatedConcept: "Birth of the Sacred" },
            { question: "What is the primary function of deifying the scapegoat?", answers: ["Memorializing the violence while concealing its human origin#", "Accurately representing the victim's power", "Preventing future violence", "Punishing the perpetrators"], relatedConcept: "Birth of the Sacred" },
            { question: "What is the purpose of 'Ritual Substitution'?", answers: ["Replaying the founding murder safely with surrogates#", "Completely eliminating violence", "Honoring the original victim", "Developing new forms of social order"], relatedConcept: "Ritual Substitution" },
            { question: "How does controlled repetition of sacrifice prevent social breakdown?", answers: ["It channels aggression predictably#", "It eliminates aggressive individuals", "It teaches moral lessons", "It pleases the gods"], relatedConcept: "Ritual Substitution" },
            { question: "What does the shift from human to animal victims in rituals suggest?", answers: ["Gradual moral discomfort with human sacrifice, yet mechanism preservation#", "A loss of belief in the ritual's efficacy", "Increased availability of animals", "A change in the nature of the gods"], relatedConcept: "Ritual Substitution" },

             // Myth, Ritual, and Cultural Institutions (MRCI)
            { question: "From whose perspective do myths typically narrate the sacrificial crisis?", answers: ["The persecutors'/victors' viewpoint#", "The victim's viewpoint", "An objective, neutral observer", "The gods' viewpoint"], relatedConcept: "Myth as Persecutor Narrative" },
            { question: "What role do fantastic motifs play in myths about scapegoating?", answers: ["Distracting from the reality of mob murder#", "Accurately describing supernatural events", "Symbolizing the victim's innocence", "Providing entertainment value only"], relatedConcept: "Myth as Persecutor Narrative" },
            { question: "What does comparative reading of diverse myths often reveal, according to Girard?", answers: ["Structural uniformity related to scapegoating#", "Completely unique and unrelated stories", "A focus on creation stories", "Evidence against collective violence"], relatedConcept: "Myth as Persecutor Narrative" },
            { question: "What is the main function of 'Ritual Sacrifice for Social Order'?", answers: ["Restaging the scapegoat killing to renew communal cohesion#", "Punishing criminals", "Appeasing angry deities", "Celebrating agricultural cycles"], relatedConcept: "Ritual Sacrifice for Social Order" },
            { question: "The Greek pharmakos and Hebrew Day of Atonement goat are examples of:", answers: ["Ritualized scapegoating for social renewal#", "Historical accounts of specific individuals", "Agricultural fertility rites", "Political ceremonies"], relatedConcept: "Ritual Sacrifice for Social Order" },
            { question: "How does ritual domesticate the violence of the founding murder?", answers: ["By presenting it as divine command, not human expedient#", "By making it less violent", "By involving only priests", "By using symbolic actions instead of real sacrifice"], relatedConcept: "Ritual Sacrifice for Social Order" },
            { question: "What do cultural 'Taboos and Moral Codes' often memorialize?", answers: ["The scapegoat's supposed sin or behaviors blamed for chaos#", "The heroic actions of founders", "Universal ethical principles", "Random historical events"], relatedConcept: "Taboos and Moral Codes" },
            { question: "The universality of incest and murder taboos mirrors what aspect of the scapegoat mechanism?", answers: ["Common stereotypes of accusation against victims#", "The actual prevalence of these crimes", "The structure of mimetic desire", "The nature of the sacred"], relatedConcept: "Taboos and Moral Codes" },
            { question: "How does Girard view the origin of law?", answers: ["As a negative recollection of communal violence#", "As a purely rational social contract", "As divine revelation", "As an invention by early rulers"], relatedConcept: "Taboos and Moral Codes" },
            { question: "Early kingship often derives its authority from:", answers: ["Occupying a former victim's place (sacred authority from sacrifice)#", "Military conquest alone", "Democratic election", "Philosophical justification"], relatedConcept: "Kingship and Legal Institutions" },
            { question: "How do legal courts relate to the scapegoat mechanism?", answers: ["They channel vengeance into codified procedures, reducing random scapegoating#", "They eliminate scapegoating entirely", "They institutionalize scapegoating", "They are unrelated to sacrificial logic"], relatedConcept: "Kingship and Legal Institutions" },
            { question: "What vestige of sacrificial logic can still be seen in legal punishment?", answers: ["The idea of 'one suffers for all'#", "The focus on rehabilitation", "The principle of 'innocent until proven guilty'", "The use of fines instead of physical punishment"], relatedConcept: "Kingship and Legal Institutions" },
            { question: "Girard connects the rise of pastoral (animal) sacrifice to:", answers: ["The displacement of earlier human victims#", "Increased efficiency in agriculture", "A change in religious beliefs", "The domestication of new animal species"], relatedConcept: "Animal Domestication as Substitute" },
            { question: "What social function did regular animal offerings provide?", answers: ["Harmless outlets for violence, stabilizing societies#", "A primary source of food", "A way to communicate with gods", "Entertainment for the community"], relatedConcept: "Animal Domestication as Substitute" },
            { question: "Scriptural requirements for 'spotless beasts' in sacrifice reflect:", answers: ["The quest for perfect, non-retaliatory substitutes#", "Concern for animal welfare", "Economic considerations", "Symbolism unrelated to violence"], relatedConcept: "Animal Domestication as Substitute" },

            // Biblical Revelation and Christian Distinctiveness (BRCD)
            { question: "How does Hebrew Scripture begin to challenge the scapegoat mechanism?", answers: ["By foregrounding innocent sufferers (Abel, Joseph, Job)#", "By endorsing ritual sacrifice", "By focusing on military heroes", "By ignoring victims altogether"], relatedConcept: "Victim Perspective in Hebrew Scripture" },
            { question: "What stance do the Hebrew Prophets take regarding ritual and victims?", answers: ["Condemning rituals masking oppression, siding with the marginalized#", "Promoting more elaborate rituals", "Justifying the suffering of victims", "Ignoring social justice issues"], relatedConcept: "Victim Perspective in Hebrew Scripture" },
            { question: "What effect do texts focusing on innocent victims have on the reader?", answers: ["Training readers to doubt unanimous violence and hear silenced voices#", "Reinforcing belief in the necessity of sacrifice", "Creating confusion about justice", "Encouraging readers to become persecutors"], relatedConcept: "Victim Perspective in Hebrew Scripture" },
            { question: "How does Girard interpret the Crucifixion of Jesus?", answers: ["As a perfect enactment of scapegoat logic#", "As a unique historical accident", "As a purely political execution", "As a divine punishment for sin"], relatedConcept: "The Cross as Final Scapegoat Exposure" },
            { question: "What is distinctive about the Gospels' portrayal of Jesus's execution?", answers: ["Emphasis on his innocence reveals the mechanism#", "It conceals the role of the crowd", "It justifies the execution", "It presents Jesus as guilty"], relatedConcept: "The Cross as Final Scapegoat Exposure" },
            { question: "What alternative to sacrificial order does the Resurrection represent for Girard?", answers: ["A non-violent alternative, breaking the cycle of revenge#", "A divine validation of sacrifice", "The establishment of a new kingdom on Earth", "A purely symbolic event"], relatedConcept: "The Cross as Final Scapegoat Exposure" },
            { question: "How does Girard interpret the figure of 'Satan'?", answers: ["As the personification of the cycle of accusation (the Accuser)#", "As a metaphysical rival to God", "As a symbol of human evil", "As a fallen angel"], relatedConcept: "Satan as Personification of Accusation" },
            { question: "What does the phrase 'I saw Satan fall' signify in Girard's view?", answers: ["The exposure and delegitimization of scapegoat power#", "A military victory over evil forces", "The end of the world", "A personal spiritual experience"], relatedConcept: "Satan as Personification of Accusation" },
            { question: "According to Girard, what should be the central focus of Christian mission?", answers: ["Breaking the cycle of accusation#", "Appeasing divine wrath through sacrifice", "Establishing political power", "Performing miracles"], relatedConcept: "Satan as Personification of Accusation" },
            { question: "Girard attributes the West's growing 'Concern for Victims' primarily to:", answers: ["Biblical/Gospel influence spreading suspicion of mob violence#", "Enlightenment philosophy", "Economic development", "Military defeats"], relatedConcept: "Western Culture’s Concern for Victims" },
            { question: "How is this 'Concern for Victims' reflected in modern culture?", answers: ["Literature and law increasingly champion the wrongly accused#", "Increased popularity of violent entertainment", "A decline in charitable giving", "Stronger emphasis on collective guilt"], relatedConcept: "Western Culture’s Concern for Victims" },
            { question: "What is the effect of this victim-centric concern on traditional sacrificial systems?", answers: ["It destabilizes them, forcing societies to find new peace-keeping tools#", "It strengthens them", "It has no effect", "It leads to their revival"], relatedConcept: "Western Culture’s Concern for Victims" },
            { question: "How does Girard describe the development of sacrificial themes within the Bible itself?", answers: ["As a progressive revelation moving from sacred violence toward unveiled innocence#", "As consistently endorsing sacrifice", "As increasingly violent over time", "As contradictory and incoherent"], relatedConcept: "Progressive Revelation Within Scripture" },
            { question: "Which parts of the Bible particularly undermine mythic justification for violence?", answers: ["Victims' laments in Psalms and prophetic critiques#", "Laws regarding sacrifice in Leviticus", "Historical accounts of wars", "Genealogies"], relatedConcept: "Progressive Revelation Within Scripture" },
            { question: "The Biblical canon, for Girard, records an internal struggle between:", answers: ["Sacred violence and the revelation of victim innocence#", "Faith and doubt", "Different political factions", "Humans and God"], relatedConcept: "Progressive Revelation Within Scripture" },

            // Contemporary Relevance and Critical Debates (CRCD)
            { question: "How is the scapegoat mechanism evident in 'Social-Media Scapegoating'?", answers: ["Rapid convergence of online outrage onto individuals (all-against-one)#", "Thoughtful, slow deliberation in online discussions", "Algorithms promoting diverse viewpoints", "Anonymity leading to less participation"], relatedConcept: "Social‑Media Scapegoating" },
            { question: "What role do algorithms play in social media scapegoating?", answers: ["Magnifying mimetic signals (likes, shares), accelerating contagion#", "Fact-checking information to slow down outrage", "Promoting empathy and understanding", "Limiting the visibility of controversial posts"], relatedConcept: "Social‑Media Scapegoating" },
            { question: "How does digital anonymity affect online mob dynamics?", answers: ["Lowers thresholds for participation, intensifying virtual mob power#", "Encourages more responsible behavior", "Makes it harder to identify scapegoats", "Reduces the speed of contagion"], relatedConcept: "Social‑Media Scapegoating" },
            { question: "How does 'Political Populism' utilize the scapegoat mechanism?", answers: ["Leaders blame elites or minorities for problems to galvanize followers#", "By promoting inclusive policies", "By encouraging rational debate", "By avoiding blame altogether"], relatedConcept: "Political Populism" },
            { question: "What is the danger of the short-term unity created by populist scapegoating?", answers: ["It masks policy failures and is prone to escalating violence#", "It leads to long-term stability", "It encourages critical thinking", "It resolves underlying economic issues"], relatedConcept: "Political Populism" },
            { question: "What does Girardian analysis suggest about the unity forged by political scapegoating?", answers: ["It is brittle and unstable#", "It is strong and enduring", "It is based on rational agreement", "It is harmless"], relatedConcept: "Political Populism" },
            { question: "How is mimetic theory applied in psychology to treat envy-driven issues?", answers: ["By exposing the hidden rival models driving the envy#", "By encouraging the patient to compete more effectively", "By prescribing medication", "By ignoring the role of envy"], relatedConcept: "Applications in Psychology and Therapy" },
            { question: "In family systems therapy, what role does the 'scapegoated member' often play?", answers: ["Absorbing collective family tension#", "Causing the family's problems", "Being the most powerful member", "Acting as a mediator"], relatedConcept: "Applications in Psychology and Therapy" },
            { question: "What practical benefit comes from awareness of mimetic triggers in therapy?", answers: ["Enabling healthier role redistribution and conflict de-escalation#", "Confirming the patient's negative self-image", "Increasing the therapist's authority", "Speeding up the diagnostic process"], relatedConcept: "Applications in Psychology and Therapy" },
            { question: "What is a common scholarly critique of Girard's 'founding murder' concept?", answers: ["It's based on an unfalsifiable pre-historic hypothesis#", "It relies too heavily on archaeological evidence", "It ignores the role of violence", "It is too specific to certain cultures"], relatedConcept: "Scholarly Critiques and Limitations" },
            { question: "How do some comparative mythologists challenge Girard's theory?", answers: ["Argue not all myths veil persecution; some focus on cosmology or fertility#", "Claim all myths are identical in structure", "Deny the existence of myth", "Insist myths are purely historical records"], relatedConcept: "Scholarly Critiques and Limitations" },
            { question: "What is a limitation pointed out by feminist and post-colonial scholars regarding Girard's work?", answers: ["His focus on male violence and Western sources#", "His overemphasis on female victims", "His use of too many non-Western sources", "His complete neglect of violence"], relatedConcept: "Scholarly Critiques and Limitations" },
            { question: "How does 'Restorative Justice' offer an alternative to scapegoating?", answers: ["Seeking dialogue and closure without victim creation#", "Implementing harsher punishments", "Ignoring the needs of the community", "Focusing solely on the perpetrator's guilt"], relatedConcept: "Breaking the Cycle – Practical Pathways" },
            { question: "What educational approaches can help 'inoculate' against mimetic frenzy?", answers: ["Education in empathy and critical media literacy#", "Focusing solely on STEM subjects", "Teaching conformity", "Promoting faster information consumption"], relatedConcept: "Breaking the Cycle – Practical Pathways" },
            { question: "What is one proposed way to reduce digital scapegoating through technology?", answers: ["Platform design changes like slower sharing or contextual prompts#", "Increasing the speed of information flow", "Removing anonymity completely", "Using AI to identify scapegoats faster"], relatedConcept: "Breaking the Cycle – Practical Pathways" }
        ];


        // --- 3. DOM Elements ---
        // References to various HTML elements used by the application's JavaScript logic.
        const knowledgeDisplayArea = document.getElementById('knowledge-display-area');
        const quizTitleElement = document.getElementById('quiz-title');
        const questionTextElement = document.getElementById('question-text');
        const answerButtonsElement = document.getElementById('answer-buttons');
        const feedbackElement = document.getElementById('feedback');
        const nextButton = document.getElementById('next-btn');
        const scoreElement = document.getElementById('score');
        const questionCounterElement = document.getElementById('question-counter');
        const sessionCounterElement = document.getElementById('session-counter');
        const gameOverMessageElement = document.getElementById('game-over-message');
        const finalScoreMessageElement = document.getElementById('final-score-message');
        const restartButton = document.getElementById('restart-btn');
        const practiceButton = document.getElementById('practice-btn');
        // Grouping quiz UI elements for easier collective manipulation (e.g., show/hide).
        const quizAreaElements = {
            quizTitleElement: quizTitleElement,
            scoreArea: document.getElementById('score-area'),
            questionArea: document.getElementById('question-area'),
            feedbackElement: feedbackElement,
            nextButton: nextButton,
        };

        // --- 4. Game State ---
        // Variables to manage the quiz's current state during execution.
        let questionsForCurrentSession = []; // Holds the questions for the active session (main or practice)
        let currentQuestionInSessionIndex = 0; // Tracks the index of the current question within the session
        let score = 0; // User's score
        let currentSessionNumber = 1; // Tracks the current main quiz session number
        const QUESTIONS_PER_SESSION = 10; // Increased questions per session
        let TOTAL_SESSIONS = 0; // Will be calculated dynamically
        let conceptsToPractice = new Set(); // Stores names of concepts answered incorrectly for practice mode
        let isPracticeMode = false; // Flag indicating if the quiz is in practice mode

        // --- 5. Functions ---

        /**
         * Dynamically builds and injects the HTML for the full knowledge base display,
         * iterating through Level 1 concepts and their Level 2 sub-topics.
         */
         function displayKnowledgeBase() {
            knowledgeDisplayArea.innerHTML = ''; // Clear previous content

            // Iterate through each Level 1 concept in the knowledgeBaseData array
            knowledgeBaseData.forEach((l1ConceptData, l1Index) => {
                // Create the main container for this Level 1 concept (<details>)
                const l1DetailsElement = document.createElement('details');
                l1DetailsElement.classList.add('level1-concept-container');
                // Open the first Level 1 concept by default
                if (l1Index === 0) l1DetailsElement.open = true;

                // Create the summary element (clickable header) for Level 1
                const l1SummaryElement = document.createElement('summary');
                l1SummaryElement.classList.add('level1-concept-header');

                // Level 1 title
                const l1TitleElement = document.createElement('h3');
                l1TitleElement.textContent = l1ConceptData.level1Concept;

                // Toggler icon for Level 1
                const l1Icon = document.createElement('span');
                l1Icon.classList.add('toggler-icon');
                l1Icon.innerHTML = '&#9654;'; // Right-pointing triangle

                // Append title and icon to the Level 1 summary
                l1SummaryElement.appendChild(l1TitleElement);
                l1SummaryElement.appendChild(l1Icon);
                l1DetailsElement.appendChild(l1SummaryElement); // Add summary to details

                // Create a wrapper div for all Level 2 topics within this Level 1 block
                const l2WrapperDiv = document.createElement('div');
                l2WrapperDiv.classList.add('level2-topics-wrapper');

                // Iterate over Level 2 Sub-Topics for the current Level 1 concept
                l1ConceptData.level2SubTopics.forEach((subTopic, l2Index) => {
                    // Create <details> element for Level 2 sub-topic
                    const l2DetailsElement = document.createElement('details');
                    l2DetailsElement.classList.add('sub-topic-container');
                    // Keep Level 2 topics closed by default unless it's the very first one overall
                    // if (l1Index === 0 && l2Index === 0) l2DetailsElement.open = true;

                    // Create <summary> for Level 2 header
                    const l2SummaryElement = document.createElement('summary');
                    l2SummaryElement.classList.add('sub-topic-header');

                    // Level 2 title
                    const l2TitleElement = document.createElement('h4');
                    l2TitleElement.textContent = subTopic.name;

                    // Toggler icon for Level 2
                    const l2Icon = document.createElement('span');
                    l2Icon.classList.add('toggler-icon');
                    l2Icon.innerHTML = '&#9654;';

                    // Append title and icon to Level 2 summary
                    l2SummaryElement.appendChild(l2TitleElement);
                    l2SummaryElement.appendChild(l2Icon);
                    l2DetailsElement.appendChild(l2SummaryElement); // Add summary to L2 details

                    // Create the list of insights for this Level 2 sub-topic
                    const insightsUl = document.createElement('ul');
                    insightsUl.classList.add('insights-list');
                    subTopic.insights.forEach(insightText => {
                        const insightLi = document.createElement('li');
                        insightLi.textContent = insightText;
                        insightsUl.appendChild(insightLi);
                    });
                    l2DetailsElement.appendChild(insightsUl); // Add insights list to L2 details

                    // Add the complete Level 2 section to the wrapper div
                    l2WrapperDiv.appendChild(l2DetailsElement);
                });

                // Add the wrapper containing all L2 topics to the main L1 details element
                l1DetailsElement.appendChild(l2WrapperDiv);

                // Add the complete Level 1 section to the main display area
                knowledgeDisplayArea.appendChild(l1DetailsElement);
            });
        }


        /**
         * Shuffles an array in place using the Fisher-Yates algorithm.
         * @param {Array} array - The array to shuffle.
         * @returns {Array} The shuffled array (note: original array is modified if not copied before passing).
         */
        function shuffleArray(array) {
            const newArray = [...array]; // Create a shallow copy
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]]; // Swap elements
            }
            return newArray;
        }


        /**
         * Initializes or resets the quiz game. Determines if it's a new main quiz or a practice session.
         * Calculates TOTAL_SESSIONS dynamically.
         * @param {boolean} practice - If true, starts a practice session based on `conceptsToPractice`. Defaults to false (starts main quiz).
         */
        function startGame(practice = false) {
            isPracticeMode = practice;
            score = 0; // Reset score
            updateScoreDisplay(); // Update UI

            // Calculate TOTAL_SESSIONS dynamically based on all available questions
            TOTAL_SESSIONS = Math.ceil(allQuizQuestions.length / QUESTIONS_PER_SESSION);

            if (isPracticeMode) {
                // --- Practice Mode Setup ---
                quizTitleElement.textContent = "Practice Weak Areas";
                const practiceQuestions = allQuizQuestions.filter(q => conceptsToPractice.has(q.relatedConcept));
                questionsForCurrentSession = shuffleArray(practiceQuestions);

                if (questionsForCurrentSession.length === 0) {
                    // Handle case where there's nothing to practice
                    finalScoreMessageElement.textContent = "No specific areas marked for practice, or you've mastered them!";
                    gameOverMessageElement.classList.remove('hidden');
                    practiceButton.classList.add('hidden');
                    restartButton.textContent = "Play Full Quiz Again?";
                    Object.values(quizAreaElements).forEach(el => el.classList.add('hidden'));
                    quizAreaElements.quizTitleElement.classList.remove('hidden');
                    return; // Exit setup
                }
            } else {
                // --- New Main Quiz Setup ---
                quizTitleElement.textContent = "Test Your Knowledge!";
                currentSessionNumber = 1; // Start from session 1
                conceptsToPractice.clear(); // Clear practice list
                prepareNewSession(); // Set up and load the first session
                return; // Exit startGame, prepareNewSession handles the rest
            }

            // --- Common Setup for Active Sessions ---
            currentQuestionInSessionIndex = 0;
            feedbackElement.innerHTML = '&nbsp;';
            gameOverMessageElement.classList.add('hidden');
            practiceButton.classList.add('hidden');
            Object.values(quizAreaElements).forEach(el => el.classList.remove('hidden'));
            quizAreaElements.nextButton.style.display = 'inline-block';
            nextButton.disabled = true;
            loadQuestion(); // Load the first question
        }


        /**
         * Sets up a new main quiz session by selecting and shuffling the appropriate questions.
         * Updates session counters and prepares the UI for the new session.
         */
        function prepareNewSession() {
            // Update the session counter display using the dynamically calculated TOTAL_SESSIONS
            sessionCounterElement.textContent = `Section: ${currentSessionNumber} / ${TOTAL_SESSIONS}`;

            // Calculate the start and end indices for slicing questions
            const start = (currentSessionNumber - 1) * QUESTIONS_PER_SESSION;
            const end = start + QUESTIONS_PER_SESSION;

            // Slice and shuffle questions for the current session
            questionsForCurrentSession = shuffleArray(allQuizQuestions.slice(start, Math.min(end, allQuizQuestions.length)));

            currentQuestionInSessionIndex = 0; // Reset question index

            // Reset UI elements
            feedbackElement.innerHTML = '&nbsp;';
            gameOverMessageElement.classList.add('hidden');
            practiceButton.classList.add('hidden');
            Object.values(quizAreaElements).forEach(el => el.classList.remove('hidden'));
            quizAreaElements.nextButton.style.display = 'inline-block';
            nextButton.disabled = true;
            nextButton.textContent = "Next Question";

            // Check if there are actually questions for this session
            if (questionsForCurrentSession.length === 0 && currentSessionNumber <= TOTAL_SESSIONS) {
                 showFinalThankYouMessage(); // Treat as end if no questions
                 return;
            }

            loadQuestion(); // Load the first question
        }


        /**
         * Loads the current question and its shuffled answer choices into the UI.
         * Updates question counters and sets the appropriate text for the 'Next' button.
         */
        function loadQuestion() {
            resetStateForNewQuestion(); // Clear previous question state

            if (currentQuestionInSessionIndex < questionsForCurrentSession.length) {
                const currentQuestion = questionsForCurrentSession[currentQuestionInSessionIndex];
                questionTextElement.textContent = currentQuestion.question; // Display question

                // Update counters based on mode
                if (isPracticeMode) {
                    questionCounterElement.textContent = `Practice Question: ${currentQuestionInSessionIndex + 1} / ${questionsForCurrentSession.length}`;
                    sessionCounterElement.textContent = `Practicing: ${currentQuestion.relatedConcept}`; // Show concept
                } else {
                    // Use the actual number of questions in this specific session array
                    const questionsInThisSession = questionsForCurrentSession.length;
                    questionCounterElement.textContent = `Question: ${currentQuestionInSessionIndex + 1} / ${questionsInThisSession}`;
                    sessionCounterElement.textContent = `Section: ${currentSessionNumber} / ${TOTAL_SESSIONS}`; // Use dynamic total
                }

                // Shuffle answers
                const shuffledAnswerStrings = shuffleArray([...currentQuestion.answers]);

                // Create answer buttons
                shuffledAnswerStrings.forEach(answerString => {
                    const button = document.createElement('button');
                    let displayText = answerString;
                    let isThisAnswerCorrect = false;
                    if (answerString.endsWith('#')) {
                        displayText = answerString.slice(0, -1); // Remove marker
                        isThisAnswerCorrect = true;
                    }
                    button.innerHTML = `<span>${displayText}</span>`; // Wrap in span
                    button.dataset.answerText = displayText; // Store clean text
                    button.classList.add('answer-btn'); // Apply styles
                    button.addEventListener('click', () => selectAnswer(button, isThisAnswerCorrect));
                    answerButtonsElement.appendChild(button);
                });

                // Configure the 'Next' button text
                nextButton.disabled = true; // Disable until answer selected
                if (currentQuestionInSessionIndex >= questionsForCurrentSession.length - 1) { // Last question of batch
                    if (isPracticeMode) {
                        nextButton.textContent = "Finish Practice";
                    } else {
                        // Check if there are more main quiz sessions *after* this one
                         const moreSessionsExist = currentSessionNumber < TOTAL_SESSIONS;
                        nextButton.textContent = moreSessionsExist ? "Finish Section" : "Finish Quiz";
                    }
                } else {
                    nextButton.textContent = "Next Question";
                }
            } else {
                // Fallback to end session if index is out of bounds
                if(isPracticeMode) endPracticeSession(); else endSession();
            }
        }


        /**
         * Resets the UI state before loading a new question.
         * Clears feedback text and removes old answer buttons.
         */
        function resetStateForNewQuestion() {
            feedbackElement.innerHTML = '&nbsp;'; // Clear feedback
            feedbackElement.classList.remove('text-green-500', 'text-red-500'); // Remove color classes
            while (answerButtonsElement.firstChild) { // Clear old answer buttons
                answerButtonsElement.removeChild(answerButtonsElement.firstChild);
            }
        }


        /**
         * Handles the logic when a user clicks an answer button.
         * Disables buttons, provides feedback, updates score, marks concepts for practice if needed,
         * and enables the 'Next' button.
         * @param {HTMLButtonElement} selectedButton - The button element the user clicked.
         * @param {boolean} isClickedAnswerCorrect - Whether the clicked answer was the correct one.
         */
        function selectAnswer(selectedButton, isClickedAnswerCorrect) {
            // Find the actual correct answer text
            const currentQuestionData = questionsForCurrentSession[currentQuestionInSessionIndex];
            let actualCorrectText = "";
            currentQuestionData.answers.forEach(ansStr => {
                if (ansStr.endsWith('#')) {
                    actualCorrectText = ansStr.slice(0, -1);
                }
            });

            // Disable all buttons and highlight the correct one
            Array.from(answerButtonsElement.children).forEach(button => {
                button.disabled = true;
                if (button.dataset.answerText === actualCorrectText) {
                    button.classList.add('correct');
                }
            });

            // Process the selected answer
            if (isClickedAnswerCorrect) {
                score++;
                updateScoreDisplay();
                feedbackElement.textContent = "Correct!";
                feedbackElement.classList.add('text-green-500');
            } else {
                selectedButton.classList.add('incorrect'); // Mark clicked button as incorrect
                feedbackElement.textContent = "Incorrect!";
                feedbackElement.classList.add('text-red-500');
                // Mark concept for practice if in main quiz
                if (!isPracticeMode) {
                    const concept = currentQuestionData.relatedConcept;
                    if (concept) {
                        conceptsToPractice.add(concept);
                    }
                }
            }
            nextButton.disabled = false; // Enable Next button
        }


        /**
         * Updates the score display element in the UI.
         */
        function updateScoreDisplay() {
            scoreElement.textContent = `Score: ${score}`;
        }


        /**
         * Handles the click event for the 'Next Question', 'Finish Section', or 'Finish Quiz' button.
         * Increments the question index and either loads the next question or ends the current session/quiz.
         */
        function handleNextButton() {
            currentQuestionInSessionIndex++; // Move to next question index
            if (currentQuestionInSessionIndex < questionsForCurrentSession.length) {
                loadQuestion(); // Load next question
            } else {
                // End of current batch
                if(isPracticeMode) endPracticeSession(); else endSession();
            }
        }


        /**
         * Called when a main quiz session ends.
         * Hides active quiz elements, shows end message, and determines next step.
         */
        function endSession() {
            Object.values(quizAreaElements).forEach(el => el.classList.add('hidden')); // Hide quiz UI
            quizAreaElements.feedbackElement.innerHTML = '&nbsp;'; // Clear feedback
            gameOverMessageElement.classList.remove('hidden'); // Show end message area

            // Check if more main sessions exist
            const moreSessionsExist = currentSessionNumber < TOTAL_SESSIONS;

            if (moreSessionsExist) {
                // End of an intermediate session
                finalScoreMessageElement.textContent = `Section ${currentSessionNumber} Complete! Current Score: ${score}`;
                restartButton.textContent = "Start Next Section";
                practiceButton.classList.add('hidden');
            } else {
                // End of the entire main quiz
                showFinalThankYouMessage();
            }
        }


        /**
         * Called when a practice quiz session ends.
         * Shows practice results and determines if practice should be offered again.
         */
        function endPracticeSession() {
            Object.values(quizAreaElements).forEach(el => el.classList.add('hidden')); // Hide quiz UI
            quizAreaElements.feedbackElement.innerHTML = '&nbsp;'; // Clear feedback
            gameOverMessageElement.classList.remove('hidden'); // Show end message area

            finalScoreMessageElement.textContent = `Practice Complete! Your score: ${score} / ${questionsForCurrentSession.length}.`;
            restartButton.textContent = "Play Full Quiz Again?"; // Offer main quiz restart

            // Offer practice again only if they didn't get 100% on the practice items shown
            if (questionsForCurrentSession.length > 0 && score < questionsForCurrentSession.length) {
                practiceButton.textContent = "Practice Again?";
                practiceButton.classList.remove('hidden');
                practiceButton.disabled = false;
            } else {
                 if (questionsForCurrentSession.length > 0 && score === questionsForCurrentSession.length) {
                     finalScoreMessageElement.textContent += " You aced the practice!";
                     // Optionally clear conceptsToPractice here if they mastered everything offered
                     // conceptsToPractice.clear(); // Decided against auto-clearing for now
                 }
                practiceButton.classList.add('hidden'); // Hide practice button
            }
        }


        /**
         * Displays the final message when the entire main quiz (all sessions) is complete.
         * Shows final score and offers practice if needed.
         */
        function showFinalThankYouMessage() {
            // Calculate total questions attempted in the main quiz
            const totalMainQuizQuestionsAttempted = allQuizQuestions.length; // Use full length now

            finalScoreMessageElement.textContent = `Main Quiz Complete! Final Score: ${score} out of ${totalMainQuizQuestionsAttempted}`;
            restartButton.textContent = "Play Full Quiz Again?";

            // Hide quiz UI, show end message
            Object.values(quizAreaElements).forEach(el => el.classList.add('hidden'));
            gameOverMessageElement.classList.remove('hidden');
            quizAreaElements.feedbackElement.innerHTML = '&nbsp;';

            // Show practice button if concepts were marked incorrect
            if (conceptsToPractice.size > 0) {
                practiceButton.textContent = "Practice Weak Areas";
                practiceButton.classList.remove('hidden');
                practiceButton.disabled = false;
            } else {
                practiceButton.classList.add('hidden');
            }
        }


        /**
         * Handles the click on the 'Restart/Continue' button after a session or quiz ends.
         */
        function handleRestartOrContinue() {
            // Check if we just finished an intermediate session of the main quiz
            const moreSessionsExist = !isPracticeMode && currentSessionNumber < TOTAL_SESSIONS;

            if (moreSessionsExist) {
                currentSessionNumber++; // Increment session number
                prepareNewSession(); // Start the next session
            } else {
                // End of full quiz or practice session -> Restart main quiz
                startGame(false);
            }
        }


        /**
         * Handles the click on the 'Practice' button.
         */
        function handlePracticeButton() {
            startGame(true); // Start game in practice mode
        }

        // --- Event Listeners ---
        nextButton.addEventListener('click', handleNextButton);
        restartButton.addEventListener('click', handleRestartOrContinue);
        practiceButton.addEventListener('click', handlePracticeButton);

        // --- Initialize ---
        // Runs once the DOM is fully loaded.
        document.addEventListener('DOMContentLoaded', () => {
            displayKnowledgeBase(); // Display the full knowledge base
            startGame(false); // Start the main quiz by default
        });
    </script>
</body>
</html>
