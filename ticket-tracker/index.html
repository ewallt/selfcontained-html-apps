<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Simple Ticket Tracker</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; max-width: 600px; margin: auto; }
    form { margin-bottom: 1rem; }
    label { display: block; margin-top: .5rem; }
    input, textarea, select, button { width: 100%; padding: .5rem; margin-top: .25rem; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      table-layout: fixed;
    }
    th, td { border: 1px solid #ccc; padding: .5rem; text-align: left; }
    th:nth-child(1), td:nth-child(1) { width: 60px; }
    th:nth-child(3), td:nth-child(3) { width: 160px; }
    .actions button { margin-right: .5rem; }
  </style>
</head>
<body>

  <h1>Ticket Tracker</h1>

  <form id="ticket-form">
    <label>
      Title
      <input type="text" id="title" required>
    </label>
    <label>
      Description
      <textarea id="description" rows="3" required></textarea>
    </label>
    <button type="submit">Add Ticket</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Status</th>
        <th>Created</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="ticket-list">
      <!-- tickets will be rendered here -->
    </tbody>
  </table>

  <script>
    const STORAGE_KEY = 'tickets';
    let tickets = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

    function save() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(tickets));
    }

    function formatDate(ts) {
      return new Date(ts).toLocaleString();
    }

    function render() {
      const tbody = document.getElementById('ticket-list');
      tbody.innerHTML = '';
      tickets.forEach(ticket => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${ticket.id}</td>
          <!-- title cell now has a tooltip showing the description -->
          <td title="${ticket.description.replace(/"/g, '&quot;')}">
            ${ticket.title}
          </td>
          <td>
            <select data-id="${ticket.id}" class="status-select">
              <option${ticket.status==='Backlog'? ' selected':''}>Backlog</option>
              <option${ticket.status==='In Progress'? ' selected':''}>In Progress</option>
              <option${ticket.status==='Done'? ' selected':''}>Done</option>
            </select>
          </td>
          <td>${formatDate(ticket.created)}</td>
          <td class="actions">
            <button data-id="${ticket.id}" class="delete-btn">Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      attachEventListeners();
    }

    function attachEventListeners() {
      document.querySelectorAll('.status-select').forEach(sel => {
        sel.addEventListener('change', e => {
          const t = tickets.find(t=>t.id===e.target.dataset.id);
          t.status = e.target.value;
          save();
          render();
        });
      });
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', e => {
          tickets = tickets.filter(t=>t.id!==e.target.dataset.id);
          save();
          render();
        });
      });
    }

    document.getElementById('ticket-form').addEventListener('submit', e => {
      e.preventDefault();
      const title = document.getElementById('title').value.trim();
      const desc  = document.getElementById('description').value.trim();
      if (!title) return;
      const id = (tickets.length > 0
        ? Math.max(...tickets.map(t=>+t.id))
        : 0
      ) + 1;
      tickets.push({
        id: id.toString(),
        title,
        description: desc,
        status: 'Backlog',
        created: Date.now()
      });
      save();
      render();
      e.target.reset();
    });

    render();
  </script>

</body>
</html>
